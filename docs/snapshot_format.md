# Snapshot Schema Specification

This document defines the structure and fields of the project snapshots generated by CodeSage. The snapshot is a JSON object that captures a comprehensive view of the project at a specific point in time.

## Root Object: `ProjectSnapshot`

The root object of a snapshot is `ProjectSnapshot`.

| Field               | Type                  | Description                                                  |
|---------------------|-----------------------|--------------------------------------------------------------|
| `metadata`          | `SnapshotMetadata`    | Metadata associated with the snapshot.                       |
| `files`             | `List[FileSnapshot]`  | A list of snapshots for each file in the project.            |
| `global_metrics`    | `Dict[str, Any]`      | Project-wide metrics (e.g., total lines, language distribution). |
| `dependency_graph`  | `DependencyGraph`     | The project's dependency graph.                              |
| `detected_patterns` | `List[DetectedPattern]` | A list of all patterns detected across the project.          |
| `issues`            | `List[AnalysisIssue]` | A list of all issues identified across the project.        |

---

## `SnapshotMetadata`

| Field          | Type           | Description                                                        |
|----------------|----------------|--------------------------------------------------------------------|
| `version`      | `str`          | The version of the snapshot (e.g., 'v1', 'v2').                    |
| `timestamp`    | `datetime`     | The timestamp when the snapshot was created.                       |
| `git_commit`   | `Optional[str]`| The git commit hash when the snapshot was taken.                   |
| `tool_version` | `str`          | The version of the CodeSage tool.                                  |
| `config_hash`  | `str`          | The MD5 hash of the configuration file used for this snapshot.     |

---

## `FileSnapshot`

| Field                 | Type                    | Description                                         |
|-----------------------|-------------------------|-----------------------------------------------------|
| `path`                | `str`                   | The relative path to the file.                      |
| `language`            | `str`                   | The programming language of the file.               |
| `hash`                | `str`                   | The SHA256 hash of the file content.                |
| `lines`               | `int`                   | The total number of lines in the file.              |
| `ast_summary`         | `ASTSummary`            | A summary of the file's AST.                        |
| `complexity_metrics`  | `ComplexityMetrics`     | Complexity metrics for the file.                    |
| `detected_patterns`   | `List[DetectedPattern]` | Patterns detected in the file.                      |
| `issues`              | `List[AnalysisIssue]`   | Issues identified in the file.                      |

---

## `ASTSummary`

| Field            | Type  | Description                                |
|------------------|-------|--------------------------------------------|
| `function_count` | `int` | Number of functions in the file.           |
| `class_count`    | `int` | Number of classes in the file.             |
| `import_count`   | `int` | Number of imports in the file.             |
| `comment_lines`  | `int` | Number of comment lines in the file.       |
